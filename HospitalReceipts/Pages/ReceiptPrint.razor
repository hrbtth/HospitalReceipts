@page "/receipt-print/{receiptId:int}"

@using HospitalReceipts.Data
@using HospitalReceipts.Models
@inject AppDbContext _context
@inject IJSRuntime JS

@code {
    private Receipt? receipt;
    private ReceiptBookMain? book;

    [Parameter] public int receiptId { get; set; }

    protected override void OnInitialized()
    {
        receipt = _context.Receipts.FirstOrDefault(r => r.ReceiptId == receiptId);
        if (receipt != null)
        {
            book = _context.ReceiptBookMain.FirstOrDefault(b => b.BookId == receipt.BookId);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && receipt != null)
        {
            // Run JavaScript print after rendering
            await JS.InvokeVoidAsync("eval", "setTimeout(() => window.print(), 300)");
        }
    }
}

@if (receipt == null || book == null)
{
    <p>Receipt not found</p>
}
else
{
    <div id="printableArea" style="background:white; padding:10mm; font-family:Arial; font-size:14px; width:148mm; height:105mm;">
        
        <div style="text-align:center; font-size:18px; font-weight:bold;">
            @book.Header1
        </div>
        <div style="text-align:center; font-size:16px;">
            @book.Header2
        </div>
        <div style="text-align:center; font-size:14px; margin-bottom:10px;">
            @book.Header3
        </div>

        <table style="width:100%; border-collapse:collapse; font-size:14px;">
            <tr>
                <td><b>No:</b> @receipt.ReceiptNo</td>
                <td style="text-align:right"><b>Date:</b> @receipt.Date.ToString("dd-MM-yyyy")</td>
            </tr>
            <tr>
                <td colspan="2"><b>Name:</b> @receipt.Name</td>
            </tr>
            <tr>
                <td colspan="2"><b>Amount:</b> @receipt.Amount.ToString("C")</td>
            </tr>
            <tr>
                <td colspan="2"><b>Towards:</b> @receipt.Towards</td>
            </tr>
        </table>
    </div>
}
<style>
    @@media print {
        body *

    {
        visibility: hidden; /* hide everything */
    }

    #printableArea, #printableArea * {
        visibility: visible; /* only show receipt */
    }

    #printableArea {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
    }

    }
</style>