@page "/receipt-print/{receiptId:int}"

@using HospitalReceipts.Data
@using HospitalReceipts.Models
@inject AppDbContext _context
@inject IJSRuntime JS

@code {
    private Receipt? receipt;
    private ReceiptBookMain? book;

    [Parameter] public int receiptId { get; set; }

    protected override void OnInitialized()
    {
        receipt = _context.Receipts.FirstOrDefault(r => r.ReceiptId == receiptId);
        if (receipt != null)
        {
            book = _context.ReceiptBookMain.FirstOrDefault(b => b.BookId == receipt.BookId);
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && receipt != null)
        {
            await JS.InvokeVoidAsync("eval", "setTimeout(() => window.print(), 300)");
        }
    }
}

@if (receipt == null || book == null)
{
    <p>Receipt not found</p>
}
else
{
    <div id="printableArea" class="page">
        <div class="receipt">
            <div class="header1">@book.Header1</div>
            <div class="header2">@book.Header2</div>
            <div class="header3">@book.Header3</div>
            <div class="header2" style="margin-bottom:15px;margin-top:5px;">@book.BookName </div>
            
            
            <table class="receipt-table">
                
                <tr>
                    <td><b>Receipt No:</b> @receipt.ReceiptNo</td>
                    <td style="text-align:right"><b>Date:</b> @receipt.Date.ToString("dd-MM-yyyy")</td>
                </tr>
                <!-- Blank row for spacing -->
                <tr><td  colspan="2" style="height:12px;"></td></tr>
                <tr>
                    <td class="tall-row" colspan="2"><b>Received From:</b> @receipt.Name</td>
                </tr>
                <tr>
                    <td class="tall-row" colspan="2"><b>An Amount of:</b> @receipt.Amount.ToString("C")</td>
                </tr>
                <tr>
                    <td class="tall-row" colspan="2"><b>Towards:</b> @receipt.Towards</td>
                </tr>
                <!-- Blank row for spacing -->
                <tr><td colspan="2" style="height:12px;"></td></tr>
                <tr>
                    <td></td>
                    <td style="text-align:center; border-top:1px dotted black; padding-top:5px;">
                        <b>Signature</b>
                    </td>
                </tr>
                    </table>
        </div>
    </div>
}

<style>
    /* A6 landscape page with NO default margins */
    @@page {
        size: A6 landscape;
        margin: 0;
    }

    body, html {
        height: 100%;
        margin: 0;
    }

    /* Page wrapper: apply outer margin */
    .page {
        width: 148mm;
        height: 105mm;
        padding: 10mm;              /* <-- this creates white space margin all around --></>*/
        box-sizing: border-box;

        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Receipt box inside the margin */
    .receipt {
        width: 100%;
        height: 100%;
        border: 1px solid black;
        background: white;
        font-family: Arial, sans-serif;
        font-size: 14px;

        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        box-sizing: border-box;
        padding: 5mm; /* inner padding for text, optional */
    }

    .header1 {
        text-align: center;
        font-size: 18px;
        font-weight: bold;
    }

    .header2 {
        text-align: center;
        font-size: 16px;
    }

    .header3 {
        text-align: center;
        font-size: 14px;
        
    }

    .receipt-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
    }

    .tall-row  {
        font-size: 16px; /* bigger text */
        line-height: 1.8; /* taller row */
        padding-top: 0px; /* extra space above */
        padding-bottom: 2px; /* extra space below */
    }

    @@media print {
        body * {
            visibility: hidden;
        }
        #printableArea, #printableArea * {
            visibility: visible;
        }
        #printableArea {
            position: absolute;
            inset: 0;
        }
    }
</style>
